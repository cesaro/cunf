
\appendix

\section{Proofs}
\label{ape:proofs}

We provided in this Appendix proofs of the statements presented in previous
sections.  For each proof, we first formulate the statement and then present
its proof by \emph{making the same assumptions as those made in the section
where the statement initially appears}.

Let us present here some notation whose presentation we had to skip due to the
space constraints of this document.

We say that a configuration $C$ of the full unfolding $\unf N$ (or enriched
prefix $\enr N$ of it), \emph{contains} an enriched event $\langle e, H
\rangle$ if $e \in C$ and $H = C \sem e$.

For any enriched event $\varepsilon = \langle e, H \rangle$ of $\unf N$ (or
enriched prefix $\enr N$ of it), we will write $\varepsilon^H$ to denote $H$
and $\varepsilon^e$ to denote $e$.  In a similar way, for enriched conditions
$\rho = \langle c, H \rangle$ of $\unf N$, we will write $\rho^H$ to denote $H$
and $\rho^c$ to denote $c$.

\subsection{A finite and complete prefix of $\unf N$}

\setcounter{theorem}{8}
\begin{theorem}
$\trunc N$ has a finite number of enriched events and is complete.
\end{theorem}

\begin{proof}
(Sketch, see Theorems 1 and 2 of \rbib{BCKS08}.) By assumption, $N$ is finite
and 1-safe net, and has a finite number of reachable markings.  Observe that
the number of configurations of $\trunc N$ must be finite, since if it were
infinite, considering the fact that every configuration is associated to one
marking in $N$, we would have infinite cutoffs in $\trunc N$, a contradiction.
As the number of configurations is finite, the number of enriched events must
be finite.

We say that a configuration $C$ \emph{contains} an enriched event $\langle e,
H_e \rangle$ if $e \in C$ and $H_e = C \sem e$.  According to this definition,
it is possible to prove that, for any configuration of $\unf N$ we can find a
configuration free of cutoffs.  That configuration must be present in $\trunc
N$.  Since $\unf N$ is complete, we can conclude that $\trunc N$ is also
complete.
\end{proof}

\subsection{Direct asymmetric conflict}

\setcounter{theorem}{11}
\begin{proposition}
For any pair of configurations $C_1, C_2 \in \conf{\unf N}$, we have $C_1
\evolves C_2$ iff $C_1 \devolves C_2$.
\end{proposition}

\begin{proof}
Assume $\lnot (C_1 \evolves C_2)$. We prove that $\lnot (C_1 \devolves C_2)$.
As $\lnot (C_1 \evolves C_2)$, then either $C_1 \not\subseteq C_2$ or there
exist some $e_1 \in C_1$ and some $e_2 \in C_2 \setminus C_1$ verifying $e_2
\nearrow e_1$.  In the first case, we have $\lnot (C_1 \evolves C_2)$ by
definition.  In the second, notice that $e_2 \uparrow e_1$ also holds, since if
it were the case that $e_2 < e_1$, the fact that $e_1 \in C_1$ and that $C_1$
is a configuration (and thus, causally closed), would imply that $e_2 \in C_1$,
which is a contradiction to $e_2 \in C_2 \setminus C_1$.  As $e_2 \nearrow e_1$
and $e_2 \not < e_1$, we have $e_2 \uparrow e_1$.  Therefore, $\lnot (C_1
\devolves C_2)$.

Assume now that $\lnot (C_1 \devolves C_2)$.  We prove that $\lnot (C_1
\evolves C_2)$.  If $\lnot (C_1 \devolves C_2)$, then either $C_1 \not\subseteq
C_2$ or there exist some $e_1 \in C_1$ and some $e_2 \in C_2 \setminus C_1$
verifying $e_2 \uparrow e_1$.  In the first case, we have $\lnot (C_1 \evolves
C_2)$ by definition.  In the second, since $e_2 \uparrow e_1$ implies $e_2
\nearrow e_1$, we also have $\lnot (C_1 \evolves C_2)$.
\end{proof}

\subsection{History graph}

In order to prove \rlem{given.hst} we need to first prove that the edge
relation of $\hst N$ is acyclic:

% new!
\setcounter{theorem}{17}
\begin{lemma}
\label{lem:the.edge}
The edge relation $\to$ of any given history graph $\hst N = (V, \to)$ is
acyclic.
\end{lemma}

\begin{proof}
For an argument by contradiction, assume that we can find a loop in the
relation $\to$ using enriched events of $V$.  Let $\langle e_1, H_1 \rangle \to
\langle e_2, H_2 \rangle \to \ldots \to \langle e_n, H_n \rangle$ be $n-1$
enriched events of $V$ such that $\langle e_1, H_1 \rangle = \langle e_n, H_n
\rangle$.  The definition of $\to$ assures that for any $\langle e_i, H_i
\rangle$, with $1 \le i < n$ it holds that $e_{i+1} \in H_i$, and that $H_{i+1}
\subseteq H_i$, and that $e_{i+1} \uparrow e_i$.  This implies that we have a
cycle in the relation $\uparrow$ using events $e_1, \ldots, e_{n-1}$.  It also
implies that $e_i \in H_1$ for $1 \le i < n$.  These two facts together say
that we can find a cycle of the relation $\uparrow$ restricted to $H_1$, which
is a contradiction, since this means that we can find a loop in the relation
$\nearrow$ restricted to $H_1$.

Therefore, relation such cycle in relation $\to$ cannot be found, and $\to$ is
acyclic.
\end{proof}

\setcounter{theorem}{13}
\begin{lemma}
Given $\hst N = (V, \to)$ and $\varepsilon = \langle e, H \rangle \in V$, we
have $H = \{e' \in T' \mid \varepsilon \to^* \langle e', H' \rangle\}$.
\end{lemma}

\begin{proof}
Due to the fact that $\hst N$ is acyclic (\rlem{the.edge}), we know that $\to$
is well founded.  We prove the statement by structural induction on the edge
relation $\to$.

\paragraph{Base case} Node $\varepsilon$ has no outgoing edge.  We have to
prove that $H = \{e\}$.  For an argument by contradiction, assume that there is
at least one enriched event $e_1 \in H \setminus \{e\}$.  As $e_1 \in H$ and
$e_1 \ne e$, we have $e_1 \nearrow^+_H e$.  This implies that we can find some
event $e_2 \in H$ that is in asymmetric conflict to $e$, $e_2 \nearrow e$ and
such that $e_2 \ne e$.  Now we claim that we can find some other event $e_3 \in
H$ verifying $e_3 \uparrow e$ and $e_3 \ne e$.  Indeed, if $e_2 \uparrow e$, we
can take $e_2$ as such $e_3$.  Otherwise, if $\lnot (e_2 \uparrow e)$, we know
that $e_2 < e$ and, since $H$ is causally closed, we can find some $e_3 \in H$
verifying $e_2 < e_3 < e$ and $e_3 \uparrow e$.  From the definition of
enriched prefix, and due to the fact that $H$ is a configuration of $\enr N$,
it must hold $H \sem{e_3} \in \chi (e_3)$.  For this reason, $\langle e_3, H
\sem{e_3} \rangle$ must be a node of $\hst N$, that is, $\langle e_3, H
\sem{e_3} \rangle \in V$.  Since, by construction, $e_3 \in H$, and $e_3
\uparrow e$, it must hold that $\varepsilon = \langle e, H \rangle \to \langle
e_3, H \sem{e_3} \rangle$.  This is a contradiction to the assumption that node
$\varepsilon$ has no outgoing edge.  Therefore, $H = \{e\}$.

\paragraph{Step} Assume that the statement holds for any $\varepsilon' =
\langle e', H' \rangle$ such that $\varepsilon \to \varepsilon'$.  We can write
the next development: $$\{e' \in T' \mid \varepsilon \to^* \langle e', H'
\rangle \} = \{e\} \cup \{e' \in T' \mid \varepsilon \to^+ \langle e', H'
\rangle \}$$  Now, consider the set $D \bydef= \{e' \in H \mid e' \uparrow
e\}$.  By the definition of $\hst N$, we can see that if $\varepsilon \to
\langle e', H \sem{e'} \rangle$ is an edge of $\hst N$, then $e' \in D$ holds.
This let us write the next development: $$\{e\} \cup \{e' \in T' \mid
\varepsilon \to^+ \langle e', H' \rangle \} = \{e\} \cup \bigcup_{e' \in D}
\{e'' \in T' \mid \langle e', H \sem{e'} \rangle \to^* \langle e'', H''
\rangle\}$$  By induction hypothesis, we know that the lemma holds for all
nodes $\varepsilon' = \langle e', H' \rangle$ such that $\varepsilon \to
\varepsilon'$.  In other words, we know that for any $e' \in D$, we have $H
\sem{e'} = \{e'' \in T' \mid \langle e', H \sem{e'} \rangle \to^* \langle e'',
H'' \rangle\}$.  Again, this allows us to write $$\{e\} \cup \bigcup_{e' \in D}
\{e'' \in T' \mid \langle e', H \sem{e'} \rangle \to^* \langle e'', H''
\rangle\} = \{e\} \cup \bigcup_{e' \in D} H \sem{e'}$$ Finally, it is easy to
see that $$\{e\} \cup \bigcup_{e' \in D} H \sem{e'} = H$$ by means of a subset
inclusion in both directions.  Direction $\subseteq$ is trivial.  Direction
$\supseteq$ can be proved by regarding a partition of $H$ in three sets,
namely $\{e\}$, $D$ and $(H \setminus \{e\}) \setminus D$.  For events in the
first two sets, it is trivial to see that the inclusion holds.  For any event
$e'' \in (H \setminus \{e\}) \setminus D$, it is not difficult to see that $e''
\in H \sem{e'}$ for some $e' \in D$.
\end{proof}


\subsection{Cutoff criterion and adequate orders}

In order to provide a proof for \rthm{atrunc.has}, we need to first provide
some two new lemmas: \rlem{atrunc.has} and \rlem{if.a}.

% new!
\setcounter{theorem}{18}
\begin{lemma}
\label{lem:atrunc.has}
$\atrunc N$ has a finite number of enriched events
\end{lemma}

% FIXME Esta prueba es incorrecta!
\begin{proof}
By contradiction, assume that $\atrunc N$ has infinite enriched events. As any
history of an enriched event is a configuration, and, in particular, a
\emph{finite} configuration, we also know that the number of finite
configurations of $\trunc{N}$ is infinite.  In the sequel, we see that under
these assumptions we can use K\"{o}nig's lemma to find an infinite sequence of
configurations $C_1, C_2, \ldots$ with $C_i \sqsubset C_{i+1}$ and
$\marking{C_1} = \marking{C_i}$ for $i \ge 1$, yielding to the fact that $C_2$
is a cutoff, which is a contradiction to the definition of $\trunc{N}$.

We define a graph $G = (V, E)$ whose set of vertices $V$ is the set of finite
configurations of $\trunc{N}$ plus the \textit{empty configuration}
$\emptyset$, and whose set of edges is a subset of the computational order
relation $\evolves$:

\begin{itemize}
\item $V = \conf{\trunc{N}} \cup \{\emptyset\}$
\item $E = \{(C_1, C_2) \in V \times V \mid C_1 \evolves C_2 \text{ and }
|C_1| + 1 = |C_2|\}$
\end{itemize}

We write $C_1 \to C_2$ for $(C_1, C_2) \in E$.  We now prove three properties
of $G$:

\begin{description}
\item[] \emph{G has finite degree.}  We show that for any $C_1$ there is only a
finite number of configurations $C_2$ such that $C_1 \to C_2$.

Consider any pair of configurations $C_1$, $C_2$ with $C_1 \to C_2$.  Then $C_1
\evolves C_2$ and $|C_1| + 1 = |C_2|$.  By definition, $C_1 \evolves C_2$
implies $C_1 \subseteq C_2$.  Then we can write $C_2 = C_1 \cup \{e\}$ for some
$e \notin C_1$.  From the fact that $C_1 \evolves C_2$ we also know that
$\lnot (e_2 \nearrow e_1)$ for all $e_1 \in C_1$ and all $e_2 \in C_2 \setminus
C_1$.  In particular $\lnot (e \nearrow e_1)$ for all $e_1 \in C_1$, so $e$ can
fire after any event $e_1$ of $C_1$.  This, together with the fact that $C_2$
is a configuration, implies that $\pre{e} \subseteq \cut{C_1}$. From this, it
follows that $e \in \post{\cut{C_1}}$.

Now notice that $\post{\cut{C_1}}$ is finite, because $C_1$ is finite and the
preset and postset of each event in $\trunc{N}$ is finite (due to our initial
assumption about the finiteness of $N$).  So there is, at most, a finite number
of \emph{different} events $e \in \post{\cut{C_1}}$ and hence a finite number
of different sets $C_1 \cup \{e\}$.  As we saw previously, any $C_2$ such that
$C_1 \to C_2$ is one of these $C_1 \cup \{e\}$ for $e \in \post{\cut{C_1}}$.
Hence, for a given $C_1$, there is at most a finite number of different edges
$C_1 \to C_2$ in $G$.

\item[] \emph{G is connected.}  We show by induction on the size of a
configuration $C$ that there exists a path from the empty configuration
$\emptyset$ to $C$.  In the base case, $|C| = 0$ and consequently $C =
\emptyset$.  The statement is trivially true.  For the step case, assume that
we can find a path for configurations of up to size $n$, or more formally, that
$\emptyset \to^* C$ if $|C| \le n$ and let $C'$ be a configuration of size
$n+1$.  From $C'$ we can extract a event $e$ maximal w.r.t. the relation
$\nearrow$.  This is always possible because $C'$ is finite and there is no
loops in $\nearrow$ restricted to $C'$.  As there exists no other $e' \in C'$
with $e \nearrow e'$, we can assure that $C' \setminus \{e\}$ is a
configuration.  Furthermore, it is a configuration of size $n$ for which the
induction hypothesis applies.  Finally, notice that $C' \setminus \{e\}
\evolves C'$, because $C' \setminus \{e\} \subseteq C'$ and the maximality
of $e$.  Consequently, $C' \setminus \{e\} \to C'$.

\item[] \emph{$G$ has an infinite number of vertices}.  By hypothesis, we know
that there is an infinite number of configurations in $\trunc{N}$.  Each
configuration is a vertex in $G$.
\end{description}

In the light of these properties, K\"{o}nig's lemma guarantees the existence in
$G$ of an infinite sequence of configurations $(C_i)_{i \ge 1}$ such that $C_1
= \emptyset$ and $C_i \to C_{i+1}$.  By hypothesis, $N$ is n-bounded, so the
number of reachable markings in $N$ is finite.  As each configuration $C_i$ has
an associated marking $\marking{C_i}$, this implies that from $(C_i)_{i \ge 1}$
we can extract an infinite subsequence of configurations $C_{i_1}, C_{i_2},
\ldots$ marked with the same marking, that is, verifying:

\begin{itemize}
\item (subsequence) $i_j < i_{j+1}$ for $j \ge 1$, and
\item (same marking) $\marking{C_{i_1}} = \marking{C_{i_j}}$ for $j \ge 2$, and
\end{itemize}

Consider now the configurations $C_{i_1}$ and $C_{i_2}$.  By construction, we
know that $C_{i_1} \to^* C_{i_2}$.  This, together with the fact that relation
$\evolves$ is transitive, implies that $C_{i_1} \evolves C_{i_2}$ and by
\rdef{adequate.order}, that $C_{i_1} \prec C_{i_2}$.  But, by construction, we
know that $\marking{C_{i_1}} = \marking{C_{i_2}}$, so $C_{i_2}$ is a cutoff.
This is a contradiction to the fact that $\trunc{N}$ is free of cutoffs.

Hence, the number of enriched events in $\trunc{N}$ is finite.
\end{proof}

% new!
\setcounter{theorem}{19}
\begin{lemma}
\label{lem:if.a}
If a finite configuration $C$ of $\unf N$ contains at least one adequate
cutoff, then there exists another configuration $C'$ such that $\marking{C} =
\marking{C'}$ and $C' \prec C$.
\end{lemma}

\begin{proof}
%We say that a configuration $C$ \emph{contains} a cutoff if there exists an
%event $e \in C$ such that the enriched event $(e, C\sem{e})$ is a cutoff.
%Notice that, as the full unfolding is a closed prefix and $C$ is a
%configuration, the enriched event $(e, C\sem{e})$ is always contained in it.

Assume that $C$ contains the adequate cutoff $\langle e, H_e \rangle$, for some
$e \in C$ and $H_e = C \sem e$.  Then, by definition, we know that either
$\marking{H_e} = m'$, with $m'$ the initial marking of $\unf N$, or there
exists another enriched event $\langle e', H_{e'} \rangle$ such that
$\marking{H_e} = \marking{H_{e'}}$ and $H_{e'} \prec H_e$.  In both cases, we
regard the history $H$ defined as $H \bydef{=} \emptyset$ in the first case and
$H \bydef{=} H_{e'}$ in the second case.  Notice that in any case, $H \prec
H_e$ (if $H = \emptyset$, then $H \sqsubset H_e$ and by definition, $H \prec
H_e$).

As $\marking{H_e} = \marking{H}$, it is possible to find an extension of $H$
firing exactly the same transitions as those labeling the set $C \setminus
H_e$.  In other words, it must be possible to find an extension $E$ of $H$
isomorphic to $C \setminus H_e$, such that $\marking{H_e \cup (C \setminus
H_e)} = \marking{H \cup E}$.  This follows from the fact that $\unf{N}$ unfolds
\emph{as much as possible} and can be proved by induction on the size of the
set $C \setminus H_e$:

\paragraph{Base}  $|C \setminus H_e| = 1$.  Assume that $C \setminus H_e =
\{e'\}$.  As $\marking{H_e} = \marking{H}$, then the transition $t$ labeling
$e'$ is enabled at $\marking{H}$ and, by the definition of full unfolding,
there exists an event $e''$ labeled by $t$ such that $H \cup \{e''\}$ is a
configuration.  Hence, $\{e''\}$ is an extension of $H$ isomorphic to $C
\setminus H_e$.

\paragraph{Step}  Assume we can find extensions of $H$ isomorphic to $C
\setminus H_e$ up to size $n$.  We show that it is also possible for size
$n+1$.  Assume that $|C \setminus H_e| = n + 1$ and consider any maximal event
$e'$ of $C \setminus H_e$ w.r.t. the relation $\nearrow$ (it must exists
because $\nearrow$ is acyclic in $C$).  As $e'$ can fire after any event in $C
\setminus H_e$, and therefore any event in $C$, we know that $C \setminus
\{e'\}$ is a configuration and that the set $(C \setminus H_e) \setminus
\{e'\}$ is an extension of $H_e$ of size $n$.  Then, the induction hypothesis
applies and says that we can find an extension $E$ of $H$, isomorphic to $(C
\setminus H_e) \setminus \{e'\}$ such that $\marking{C \setminus \{e'\}} =
\marking{H \cup E}$.  But now notice that the transition $t$ labeling $e'$ is
enabled at $\marking{H \cup E}$ and, therefore there exists an event $e''$
labeled by $t$ such that $H \cup E \cup \{e''\}$ is a configuration and $E \cup
\{e''\}$ is an extension of $H$ isomorphic to $C \setminus H_e$.

We claim now that $C' \bydef{=} H \cup E$ is the configuration we are searching
for.  To see this, we just have to verify that $C' \prec C$.  We do it using
the third condition of \rdef{adequate.order}.  Indeed, $H_e$ and $H$ are
configurations with the same marking; by hypothesis $H_e \sqsubset C$ and by
construction $H \sqsubset H \cup E$ and $E$ is isomorphic to $C \setminus H_e$.
Hence $H \cup E \prec C$.
\end{proof}

\setcounter{theorem}{15}
\begin{theorem}
$\atrunc N$ has a finite number of enriched events and is complete.
\end{theorem}

\begin{proof}
That $\atrunc N$ has a finite number of enriched events is proved by
\rlem{atrunc.has}.  We prove now that, making use of \rlem{if.a}, that we can
show completeness of $\atrunc N$.

We know after \rpro{unf.is} that $\unf N$ is a complete enriched prefix.
Therefore, for any marking $m$ of $N$ we can find a configuration $C \in
\conf{\unf N}$ with $\marking C = m$.  We show now that for such configuration
$C$ we can find another configuration $C'$ with the same marking and free of
adequate cutoffs that, consequently, belongs to $\trunc{N}$.

Let $C \in \conf{\unf N}$ be a configuration of the full unfolding.  If $C$ is
free of cutoffs, then all enriched events $\langle e, C \sem e \rangle$ are
enriched events of $\atrunc N$ and therefore $C$ is a configuration of
$\atrunc N$.

So, let us assume that $C$ contains a cutoff.  By \rlem{if.a} we can find
another configuration $C_1 \in \conf{\unf N}$ with $\marking C = \marking{C_1}$
and $C_1 \prec C$.  If $C_1$ still contains cutoffs, we can apply again
\rlem{if.a} and find another configuration $C_2 \prec C_1$ with $\marking{C_2}
= \marking{C}$.  Furthermore, as $\prec$ is well founded, the number of times
we have to apply \rlem{if.a} in order to find a configuration $C_n$ free of
cutoffs is finite,  otherwise we would either have an infinite decreasing
sequence of configurations w.r.t. the order $\prec$, or a counterexample for
\rlem{if.a}.
\end{proof}

\subsection{Optimizations}

The goal of this section is providing a proof for \rthm{two.different}.  For
the sake of simplicity in the following developments, we first characterize the
concurrency relation in terms of the $\nearrow$ relation.

% new!
\setcounter{theorem}{20}
\begin{remark}
\label{rmk:the.statement}
The statement $\langle H, c\rangle \parallel \langle H', c' \rangle$ is
equivalent to the conjunction of the next four statements:
\begin{enumerate}
\item $\lnot (\exists e_1 \in H,\, \exists e_2 \in H' \setminus H,\, e_2
\nearrow e_1)$
\item $\lnot (\exists e_1 \in H',\, \exists e_2 \in H \setminus H',\, e_2
\nearrow e_1)$
\item $\lnot (\exists e_1 \in H,\, c' \in \pre{e_1})$
\item $\lnot (\exists e_1 \in H',\, c \in \pre{e_1})$
\end{enumerate}
\end{remark}

More intuitively, \rrmk{the.statement} says that $\langle H, c\rangle \parallel
\langle H', c' \rangle$ holds if and only if $H$ can evolve to $H \cup H' $
(1), $H'$ can evolve to $H \cup H'$ (2) and none of any histories consumes the
condition generated by the other history (3 and 4).  Note that the conjunction
of conditions 1 and 2 is equivalent to $\lnot (H \confl H')$ while the
conjunction of conditions 3 and 4 is equivalent to $c, c' \in \cut{H \cup H'}$.

Let us now provide the technical lemmas \rlem{let.H} and \rlem{two.histories}.

% new!
\setcounter{theorem}{21}
\begin{lemma}
\label{lem:let.H}
Let $\enr N = \langle \pref N, \chi \rangle$ be an enriched prefix and $H, H'
\in \chi (e)$ be two histories of some event $e$ of $\pref N$.  If $H \not=
H'$, then $H \confl H'$.
\end{lemma}

\begin{proof}
As both histories are histories for event $e$, it holds that $e \in H$ and $e
\in H'$.  As $H \ne H'$, it holds that $H \setminus H' \ne \emptyset$.  This
means that we can find some event $e_1 \in H \setminus H'$ in $H$ and not in
$H'$.  Due to the fact that $H$ is a history of $e$, we can assure that $e_1
\nearrow^*_H e$.  Taking into account that $e_1 \notin H'$ and that $e \in H'$,
we can be sure that $e_1 \ne e$, which entails that $e_1 \nearrow^+_H e$ holds.
In turn, this implies that we can find events $e_2, \ldots, e_n \in H$ such
that $n \ge 2$, and $e = e_n$, and $e_1 \nearrow e_2 \nearrow \ldots \nearrow
e_{n-1} \nearrow e_n$.  Additionally, $e_1 \in H \setminus H'$ and $e_n \in
H'$.  It is now easy to see that there exists some $e_i$, with $1 \le i < n$,
verifying $e_i \in H \setminus H'$ and $e_{i+1} \in H'$.  This implies that $H
\confl H'$
\end{proof}

% new!
\setcounter{theorem}{22}
\begin{lemma}
\label{lem:two.histories}
Let $H, H'$ be two histories of $\enr N = \langle \pref N, \chi \rangle$, with
$H' \prec H$, and $H \in \chi (e)$ and $e \in H'$.  Then $H \confl H'$.
\end{lemma}

\begin{proof}
We claim that $H \not\sqsubseteq H'$.  Indeed, if it were the case that $H
\evolves H'$, and provided that any adequate order $\prec$ is antisymmetric, we
would have $H \prec H'$, a contradiction to the hypothesis $H' \prec H$.  So $H
\not\sqsubseteq H'$ holds.  Making use of the definition of $\evolves$
(\rpag{pag:evolves}), one can write the next equivalence: $$H \not\sqsubseteq
H' \iff H \not\subseteq H' \lor \exists e_1 \in H,\, \exists e_2 \in H'
\setminus H,\, e_2 \nearrow e_1$$  As $H \not\sqsubseteq H'$ holds, the
right-hand side also holds.  We show that both sides of the disjunction in the
right-hand size implies $H \confl H'$.

Clearly, $\exists e_1 \in H,\, \exists e_2 \in H' \setminus H,\, e_2 \nearrow
e_1$ implies $H \confl H'$.  On the other hand, $H \not\subseteq H'$ implies
that we can find some event $e'' \in H \setminus H'$.  Now notice that, as $e''
\in H$, it holds that $e'' \nearrow^*_H e$.  Event $e$ and $e''$ must be
different because $e \in H'$ by hypothesis and $e'' \notin H'$.  Consequently
it also holds that $e'' \nearrow^+_H e$.  This means that we can find a finite
number of events $e_1, \ldots, e_n \in H$ with $e'' = e_1 \nearrow e_2 \nearrow
\ldots \nearrow e_n = e$.  It is easy to see that there must exist some pair of
events $e_l, e_{l+1}$ for some $1 \le l < k$ with $e_l \in H \setminus H'$ and
$e_{l+1} \in H'$.  By construction, $e_l \nearrow e_{l+1}$ and hence $H \confl
H'$.
\end{proof}

\setcounter{theorem}{16}
\begin{theorem}
Let $\rho = \langle H, c \rangle$, $\rho' = \langle H', c' \rangle$ be two
different enriched conditions of $\enr N$ such that $H \in \chi(e)$, $H' \in
\chi(e')$ and $H' \prec H$ for an adequate order $\prec$.  We have the
equivalence $$\rho \parallel \rho' \iff \bigwedge_{\rho_i \in \pre{\pre\rho}}
\rho_i \parallel \rho' \; \land \; \bigwedge_{\sigma_j \in \cont{\pre\rho}}
\sigma_j \parallel \rho' \; \land \; (\rho' \notin \pre{\pre \rho}) \; \land \;
\lnot \exists e'' \in H' \setminus H,\, \cont{e''} \cap \pre e \not=
\emptyset$$
\end{theorem}

\begin{proof}
Let $\pre{\pre\rho} = \{\rho_1, \ldots, \rho_n\}$ and $\cont{\pre\rho} =
\{\sigma_1, \ldots, \sigma_m\}$.  We let variable $\rho_i = \langle H_i, c_i
\rangle$ to range the set $\pre{\pre \rho}$ and variable $\sigma_j = \langle
H_j, c_j \rangle$ to range the set $\cont{\pre \rho}$, with $1 \le i \le n$ and
$1 \le j \le m$.  For any $\rho_i$ and $\sigma_j$, we let $H_i \in \chi (e_i)$
and $H_j \in \chi (e_j)$.  Note also that, by definition, $H_i = H \sem{e_i} =
H\sem{c_i}$ and that $H_j = H\sem{e_j} = H\sem{c_j}$.  It is easy also to see
that for any pair $\rho_1, \rho_2 \in \pre{\pre\rho} \cup \cont{\pre\rho}$ we
have $\rho_1 \parallel \rho_2$.  Finally note that, also by construction, $H =
\{e\} \cup \bigcup_{\rho_i \in \pre{\pre\rho}} \rho^H_i \cup \bigcup_{\sigma_j
\in \cont{\pre\rho}} \sigma^H_j$.

We prove in the sequel both directions of the co-implication.  From left to
right, we prove that the hypothesis implies each one of the conjunctions.

\begin{enumerate}[(a)]
\item $\rho \parallel \rho' \implies \bigwedge_{\rho_i \in \pre{\pre
\rho}} \rho_i \parallel \rho'$  It is enough to prove that $\rho \parallel
\rho' \implies \rho_i \parallel \rho'$ for \emph{some} $\rho_i$.  As we do not
make any assumption on $\rho_i$, the proof will be valid for \emph{all}
$\rho_i$.

Assume that $\rho \parallel \rho'$ and that, for a proof by contradiction,
$\lnot (\rho_i \parallel \rho')$ for some $\rho_i \in \pre{\pre\rho}$.  Then we
know that at least one of the four statements in \rrmk{the.statement} must be
false when regarding $\rho_i$ and $\rho'$.  We proceed by cases:

\begin{enumerate}[1.]
\item Assume that there exist events $e_1 \in H_i$ and $e_2 \in H' \setminus
H_i$ with $e_2 \nearrow e_1$.  Two cases are possible: either $e_2 \in H$ or
$e_2 \notin H$.  If $e_2 \notin H$, as $H_i \subseteq H$, we have that $e_1 \in
H$, $e_2 \in H' \setminus H$ and $e_2 \nearrow e_1$, which implies $H \confl
H'$.  This is a contradiction to $\rho \parallel \rho'$.  So, let us assume
that $e_2 \in H$.  As $H = \{e\} \cup \bigcup_{\rho_i \in \pre{\pre\rho}}
\rho^H_i \cup \bigcup_{\rho_j \in \cont{\pre \rho}} \rho^H_j$, several
sub-cases are possible:

\begin{itemize}
\item $e_2 \in \rho^H_{i'}$ for some $\rho_{i'} \in \pre{\pre\rho}$ with $i'
\not= i$.  Again, we have $e_1 \in H_i$, $e_2 \in \rho^H_{i'} \setminus H_i$
and $e_2 \nearrow e_1$.  This implies $\rho^H_{i'} \confl H_i$, which is a
contradiction to $\rho_i \parallel \rho_{i'}$.

\item $e_2 \in \sigma^H_j$ for some $\sigma_j \in \cont{\pre\rho}$.  Likewise,
we have $e_1 \in H_i$, $e_2 \in \sigma^H_j \setminus H_i$, $e_2 \nearrow e_1$
and $\sigma^H_j \confl H_i$, which is a contradiction to $\rho_i \parallel
\sigma_j$.

\item $e_2 = e$.  By definition \rdef{history}, we have $e_1 \nearrow^*_{H_i}
e_i$ (recall that $H_i \in \chi(e_i)$).  By construction of $H$, we have $e_i
\nearrow e$.  By hypothesis, we have $e_2 = e$ and also by hypothesis we have
$e_2 \nearrow e_1$.  This leads to the cycle $e_1 \nearrow^*_{H_i} e_i \nearrow
e = e_2 \nearrow e_1$ in the asymmetric conflict relation.  Now notice that
$e_1, e_i, e \in H$, and that $H_i \subseteq H$.  Therefore, we have a loop in
the asymmetric conflict relation restricted to the history $H$, which is a
contradiction to the fact that $H$ is a history.
\end{itemize}

\item Assume that there exist $e_1 \in H'$ and $e_2 \in H_i \setminus H'$ with
$e_2 \nearrow e_1$.  Then, as $H_i \subseteq H$, we have that $e_2 \in H
\setminus H'$.  This together with $e_1 \in H'$ and $e_2 \nearrow e_1$ implies
$H \confl H'$, which is a contradiction to $\rho \parallel \rho'$.

\item Assume that there exists $e_1 \in H_i$ such that $c' \in \pre{e_1}$.
Intuitively, this means that $H_i$ consumes $c'$.  As $H_i \subseteq H$, also
$H$ consumes $c'$, which leads to a contradiction of $\rho \parallel \rho'$.

\item Assume that there exists $e_1 \in H'$ such that $c_i \in \pre{e_1}$.  We
have two cases, either $e_1 = e$ or $e_1 \not= e$.  If we assume that $e_1
\not= e$, then we have that $\pre e \cap \pre{e_1} \not= \emptyset$.  This
implies that $e \nearrow e_1$ and that $e_1 \nearrow e$.  In turn, it implies
that $e_1 \notin H$ (otherwise we would have a loop in the relation $\nearrow$
restricted to $H$).  So assuming that $e_1 \not= e$ would lead to conclude that
$e_1 \in H' \setminus H$ and that $e_1 \nearrow e$, with $e \in H$, which
implies that $H \confl H'$, a contradiction to $\rho \parallel \rho'$.

Therefore, let us assume that $e_1 = e$ and, consequently, that $e \in H'$.
As, by hypothesis $H' \prec H$, we can apply \rlem{two.histories} and conclude
that $H \confl H'$, a contradiction to $\rho \parallel \rho'$.
\end{enumerate}

\item $\rho \parallel \rho' \implies \bigwedge_{\sigma_j \in \cont{\pre\rho}}
\sigma_j \parallel \rho'$  As in (a), it is still enough to prove that the
statement holds for just one $\sigma_j$.  In particular, we will prove that
$\rho \parallel \rho' \implies \sigma_j \parallel \rho'$ for some $\rho_j \in
\cont{\pre\rho}$.  As we make no assumption about $\sigma_j$, the argument will be
valid for \emph{all} $\sigma_j$.

We reason by contradiction.  Assume that both $\rho \parallel \rho'$ and $\lnot
(\sigma_j \parallel \rho')$ hold, for some $\sigma_j \in \cont{\pre\rho}$.  As
$\lnot (\sigma_j \parallel \rho')$, we know that at least one of the four
statements in \rrmk{the.statement} must not hold.  In the following, we see
that we can find a contradiction in each case.

\begin{enumerate}[1.]
\item Assume that there exist events $e_1 \in H_j$ and $e_2 \in H' \setminus
H_j$ with $e_2 \nearrow e_1$.  As in (a.1), two cases are possible: either $e_2
\in H$ or $e_2 \notin H$.  If $e_2 \notin H$, as $H_j \subseteq H$, we have
that $e_1 \in H$, $e_2 \in H' \setminus H$ and $e_2 \nearrow e_1$, which
implies $H \confl H'$.  This is a contradiction to $\rho \parallel \rho'$.  So,
let us assume that $e_2 \in H$.  As $H = \{e\} \cup \bigcup_{\rho_i \in
\pre{\pre\rho}} \rho^H_i \cup \bigcup_{\sigma_j \in \cont{\pre \rho}}
\sigma^H_j$, several sub-cases are possible:

\begin{enumerate}
\item $e_2 \in \sigma^H_{j'}$ for some $\sigma_{j'} \in \cont{\pre\rho}$ with
$j' \not= j$.  Again, we have $e_1 \in H_j$, $e_2 \in \sigma^H_{j'} \setminus
H_j$ and $e_2 \nearrow e_1$.  This implies $\sigma^H_{j'} \confl H_j$, which is
a contradiction to $\sigma_j \parallel \sigma_{j'}$.

\item $e_2 \in \rho^H_i$ for some $\rho_i \in \pre{\pre\rho}$.  Likewise, we
have $e_1 \in H_j$, $e_2 \in \rho^H_i \setminus H_j$, $e_2 \nearrow e_1$ and
$\rho^H_i \confl H_j$, which is a contradiction to $\sigma_j \parallel \rho_i$.

\item $e_2 = e$.  Recall that $H_j \in \chi (e_j)$.  By definition
\rdef{history}, we have $e_1 \nearrow^*_{H_j} e_j$.  By construction of $H$, we
have $e_j \nearrow e$.  By hypothesis, we have $e_2 = e$ and also by hypothesis
we have $e_2 \nearrow e_1$.  This leads to the cycle $e_1 \nearrow^*_{H_j} e_j
\nearrow e = e_2 \nearrow e_1$ in the asymmetric conflict relation.  Now notice
that $e_1, e_j, e \in H$, and that $H_j \subseteq H$.  Therefore, we have a
loop in the asymmetric conflict relation restricted to the history $H$, which
is a contradiction to the fact that $H$ is a history.
\end{enumerate}

\item Assume that there exist $e_1 \in H'$ and $e_2 \in H_j \setminus H'$ with
$e_2 \nearrow e_1$.  The same argument as in (a.2) is still applicable here,
changing $H_i$ by $H_j$.

\item Assume that there exists $e_1 \in H_j$ such that $c' \in \pre{e_1}$.
Same argument as in (a.3), substituting $H_i$ by $H_j$.

\item Assume that there exists $e_1 \in H'$ such that $c_j \in \pre{e_1}$.  We
then know that $\cont{e} \cap \pre{e_1} \ne \emptyset$.  As we deal with nets
in which for any event $e''$ it is not the case that $\cont{e''} \cap \pre{e''}
\not= \emptyset$, we have to assume that $e \not= e_1$.  Notice also that $e
\nearrow e_1$.  We claim now that $e \in H'$.  By contradiction, if it were the
case that $e \notin H'$, we would have that $e \in H \setminus H'$, $e_1 \in
H'$ and $e \nearrow e_1$, and consequently $H \confl H'$.

Therefore we know that $e \in H'$.  By hypothesis we also know that $H' \prec
H$.  Under this assumptions we can apply \rlem{two.histories} and conclude that
$H \confl H'$, a contradiction to $\rho \parallel \rho'$.
\end{enumerate}

\item $\rho \parallel \rho' \implies \rho' \notin \pre{\pre\rho}$  It is easy
to see that it cannot be the case that $\rho' \in \pre{\pre\rho}$ holds if we
assume $\rho \parallel \rho'$.  Indeed, if $\rho' \in \pre{\pre\rho}$ we have
that $\rho' = \rho_i = (H_i, c_i)$ for some $\rho_i \in \pre{\pre\rho}$.  But
notice that event $c_i \in \pre e$, that is, event $e$ consumes $c_i$.  This
implies that the third statement of \rrmk{the.statement} doesn't hold with
regard to $\rho$ and $\rho'$ and we have $\lnot (\rho \parallel \rho')$, a
contradiction.

\item $\rho \parallel \rho' \implies \lnot \exists e'' \in H' \setminus
H,\, \cont{e''} \cap \pre e \not= \emptyset$  Assume, for an argument by
contradiction, that it is the case that there exists $e'' \in H' \setminus H$
such that $\cont{e''} \cap \pre e \not= \emptyset$.  In consequence, we have
$e'' \nearrow e$, with $e \in H$ and $e'' \in H' \setminus H$, which implies $H
\confl H'$, a contradiction to $\rho \parallel \rho'$.

\item $\rho \parallel \rho' \Longleftarrow \bigwedge_{\rho_i \in \pre{\pre
\rho}} \rho_i \parallel \rho' \land \bigwedge_{\rho_j \in \cont{\pre \rho}}
\rho_j \parallel \rho' \land (\rho' \notin \pre{\pre \rho}) \land \lnot \exists
e'' \in H' \setminus H,\, \cont{e''} \cap \pre e \not= \emptyset$  We prove now
the opposite direction of the theorem.  We assume the right-hand side of the
implication and the negation of the left-hand side.  As $\lnot (\rho \parallel
\rho')$, one of the statements of \rrmk{the.statement} must be false:

\begin{enumerate}[1.]
\item Assume that there exist events $e_1 \in H$ and $e_2 \in H' \setminus H$
with $e_2 \nearrow e_1$.  Recall that $H = \{e\} \cup \bigcup_{\rho_i \in
\pre{\pre\rho}} \rho^H_i \cup \bigcup_{\sigma_j \in \cont{\pre\rho}}
\sigma^H_j$.  We regard $e_1$ and reason by cases:

\begin{itemize}
\item Assume that $e_1 \in H_i$ for some $\rho_i \in \pre{\pre\rho}$. As $H_i
\subseteq H$, we still have $e_2 \in H' \setminus H_i$, and hence $H_i \confl
H'$, a contradiction to $\rho_i \parallel \rho'$.

\item Assume that $e_1 \in H_j$ for some $\sigma_j \in \cont{\pre\rho}$.  In
the same way, we can see that $H_j \confl H'$, a contradiction.

\item Finally, assume that $e_1 = e$ and, consequently, $e_2 \nearrow e$.
\rdef{asymmetric.conflict} provides us three cases:

\begin{itemize}
\item Assume that $\pre{e_2} \cap \pre e \not= \emptyset$.  Under this
assumption, $e_2 \in H'$ clearly consumes $c_i$ for one $\rho_i \in
\pre{\pre\rho}$, which implies that $\lnot (\rho' \parallel \rho_i)$, a
contradiction.

\item Assume that $e_2 < e$.  We know that $H$ is a history, and by definition
contains all events $e'' < e$.  As $e_2$ is one such event, we have $e_2 \in
H$, which is a contradiction to the assumption $e_2 \in H' \setminus H$.

\item Assume that $\cont{e_2} \cap \pre e \not= \emptyset$.  This is a
contradiction to the last conjunction in hypothesis of the statement that we
are proving.
\end{itemize}
\end{itemize}

\item Assume that there exist events $e_1 \in H'$ and $e_2 \in H \setminus H'$
with $e_2 \nearrow e_1$.  Using the same arguments as in (e.1), we can
immediately discard the cases where $e_2 \in H_i$ for some $\rho_i \in
\pre{\pre\rho}$ or $e_2 \in H_j$ for some $\sigma_j \in \cont{\pre\rho}$.  We
assume, hence, that $e_2 = e$.  \rdef{asymmetric.conflict} gives us three cases
to examine in the relation $e \nearrow e_1$:

\begin{itemize}
\item Assume that $\pre{e} \cap \pre{e_1} \not= \emptyset$.  Then event $e_1
\in H'$ consumes $c_i$ for some $\rho_i \in \pre{\pre\rho}$, which leads to the
contradiction $\lnot (\rho_i \parallel \rho)$.

\item Assume that $e < e_1$.  As $e_1 \in H'$ and $H'$ is a history, we should
have $e \in H'$, while by hypothesis $e = e_2 \in H \setminus H'$ and hence $e
\notin H'$.

\item Assume that $\cont e \cap \pre{e_1} \not= \emptyset$.  Then $c_j \in
\pre{e_1}$ for some $\sigma_j \in \cont{\pre\rho}$.  As $e_1 \in H'$, we have
that $\lnot (\sigma_j \parallel \rho')$.  This is a contradiction.
\end{itemize}

\item Assume that there exists $e_1 \in H$ such that $c' \in \pre{e_1}$.  If we
assume $e_1 \in H_i$ for some $\rho_i \in \pre{\pre\rho}$, we will find the
contradiction $\lnot (\rho_i \parallel \rho')$.  Similarly, if we assume $e_1
\in H_j$ for some $\sigma_j \in \cont{\pre\rho}$ we will reach the
contradiction $\lnot (\sigma_j \parallel \rho')$.  So the only case that we
examine is when $e_1 = e$.  If $c' \in \pre e$, we have that $c' = c_i$ for
some $\rho_i \in \pre{\pre\rho}$.  As $|\pre{c''}| = 1$ for any $c''$, we have
that $H_i \in \chi(e'')$ iff $H' \in \chi(e'')$ for some $e''$.  Intuitively,
this means that $H_i$ and $H'$ are histories for the same event.  Furthermore,
they are different by hypothesis ($\rho' \notin \pre{\pre\rho}$ is one of the
hypothesis).  Under this assumptions, we can apply \rlem{let.H} and conclude
that $H' \confl H_i$, which is a contradiction.

\item Assume that there exists $e_1 \in H'$ such that $c \in \pre{e_1}$.  Then
$e \in H'$, and $H'$ consumes any $c_i$ for $\rho_i \in \pre{\pre\rho}$, which
is a contradiction.
\end{enumerate}
\end{enumerate}
\end{proof}


\section{Algorithms}
\label{ape:algorithms}

In this section we present the pseudocode of the algorithms used to compute the
procedure \peupdate{} of \ralg{unfolding.procedure}.  \ralg{pe.update} presents
this procedure.  As the reader can see, its operation is divided in three
steps, namely, procedures \peupdatecont{}, \peupdatexisting{} and
\peupdatenew{}, presented respectively in \ralg{pe.updatecont},
\ralg{pe.updatexisting} and \ralg{pe.updatenew}.  What follows is a brief
intuitive description of the rationale for this division.

Procedure \peupdatecont{}, when called on the argument $\langle e, H \rangle$
returns the set of all possible extensions of $\langle e', H' \rangle$ induced
by $\langle e, H \rangle$ such that $e'$ consumes a condition in the context of
$e$.  All the possible enriched events that it can return are built on the base
of events $e'$ that are already present in $\enr N$ (in $T'$).  No new
occurrence of a transition from $N$ is returned.  To compute new histories for
such events $e'$, \peupdatecont{} uses the histories already present in $\enr
N$ for $e'$ and tries to \textit{extend} each one of them with $H$.  This
already provides a gain in performance over the general method presented in
\rsec{computation.possible}, since we can avoid here a systematic enumeration
of all the histories generating conditions $\pre{e'} \cup \cont{e'}$.

On the other hand, procedure \peupdatexisting{} computes new histories for
events $e'$ already present in $\enr N$ and consuming (or reading) conditions
generated by $e$.  For each one of them, procedure in \peupdategenhist{}
(\ralg{pe.updategenhist}) generates all the possible histories that $e'$
currently have in $\enr N$.

Finally, \peupdatenew{} examines the original net $N$ and searches for all the
events $e' = \langle M_p, M_c, t\rangle$ that can be appended to $\enr N$ due
to the fact that they now have at least one history thanks to the addition of
$\langle e, H \rangle$ to $\enr N$.  \ralg{pe.updatenew} generates, thus,
enriched events such that event part is new in $\enr N$ (of course, also the
history part).

The rationale behind this division division might be understood in the
following way.  Each new possible extension induced by the addition of $\langle
e, H \rangle$ to $\enr N$ is an enriched event $\langle e', H'\rangle$ such
that either $e'$ is already present in $\enr N$ (in $T'$) or not.  If $e'$ is
present in $\enr N$, it must be one $e'$ for which $e \uparrow e'$ holds.  All
the cases for such $e'$ are covered by \peupdatecont{} and \peupdatexisting{}.
If $e'$ is still not in $\enr N$, it must be one $e'$ from $\unf N$ such that
$e \uparrow e'$ holds in $\unf N$.  Procedure \peupdatenew{} enumerates all
such $e'$ and, with the help of \peupdategenhist{}, filters out those which
either are already present in $\enr N$ or do not have a history (in $\enr N$).

\begin{algorithm}
\caption{Procedure \peupdate{}}
\label{alg:pe.update}

\begin{algorithmic}
\REQUIRE $\langle e, H \rangle$, the last possible extension appended to $\enr
N$
\ENSURE The set $U$ contains all the possible extensions induced by $\langle e,
H \rangle$

\STATE $U = \peupdatecont (e, H)$
\STATE $U = U \cup \peupdatexisting (e, H)$
\STATE $U = U \cup \peupdatenew (e, H)$
\RETURN $U$

\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Procedure \peupdatecont}
\label{alg:pe.updatecont}

\begin{algorithmic}
\REQUIRE $\langle e, H \rangle$, the last possible extension appended to $\enr
N$
\ENSURE The set $U$ contains all the possible extensions $\langle e', H'
\rangle$ induced by $\langle e, H \rangle$ such that $\cont{e}
\cap \pre{e'} \neq \emptyset$ and $\post{e} \cap \pre{e'} = \emptyset$

\STATE $U = \emptyset$
\FORALL {$e' \in T'$ such that $\cont{e} \cap \pre{e'} \neq \emptyset$ and
$\post{e} \cap \pre{e'} = \emptyset$}
\FORALL {$H' \in \chi(e')$}

\STATE $f = $ \TRUE
\FORALL {$H''$ such that $\langle e', H'\rangle \to \langle e'', H''\rangle$
is an edge of $\hst N$ and $e \neq e''$}
\STATE $f = f \land \lnot H \confl H''$
\STATE $f = f \land H \mbox{ does not consume conditions } (\post{e''} \cup
\cont{e''}) \cap (\pre{e'} \cup \cont{e'})$
\STATE $f = f \land H' \mbox{ does not consume conditions } \cont e \cap
\pre{e'}$
\ENDFOR

\STATE $\widehat H = H \cup H'$

\IF{$f$ and not $\widehat H \in \chi (e')$}
\STATE $U = U \cup \{\langle e', \widehat H \rangle\}$
\ENDIF
\ENDFOR
\ENDFOR

\RETURN $U$

\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Procedure \peupdatenew}
\label{alg:pe.updatenew}

\begin{algorithmic}
\REQUIRE $\langle e, H \rangle$, the last possible extension appended to $\enr
N$
\ENSURE The set $U$ contains all the possible extensions $\langle e', H'
\rangle$ induced by $\langle e, H \rangle$ such that $e'$ is still not present
in $T'$, and $\post e \cap (\pre{e'} \cup \cont{e'}) \neq \emptyset$.

\STATE $U = \emptyset$
\FORALL {$c \in \post e$}
\STATE Let $p = f_P (c)$
\FORALL {$t$ such that $p \in \pre t \cup \cont t$}
\STATE Let $\{p_1, \ldots, p_n\} = \pre t$
\STATE Let $\{q_1, \ldots, q_m\} = \cont t$
\FORALL {$M_p = \{c_1, \ldots, c_n\}$ such that $f_P (c_i) = p_i$ for $1 \le i
\le n$}
\FORALL {$M_c = \{d_1, \ldots, d_m\}$ such that $f_P (d_i) = q_i$ for $1 \le i
\le m$}

\IF {not $\langle M_p, M_c, t \rangle \in T'$}
\STATE $U = U \cup \peupdategenhist (\langle M_p, M_c, t \rangle)$
\ENDIF

\ENDFOR
\ENDFOR
\ENDFOR
\ENDFOR

\RETURN $U$

\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Procedure \peupdatexisting}
\label{alg:pe.updatexisting}

\begin{algorithmic}
\REQUIRE $\langle e, H \rangle$, the last possible extension appended to $\enr
N$
\ENSURE The set $U$ contains all the possible extensions $\langle e', H'
\rangle$ induced by $\langle e, H \rangle$ such that $e'$ is already present in
$T'$, and $\post e \cap (\pre{e'} \cup \cont{e'}) \neq \emptyset$.

\STATE $U = \emptyset$
\FORALL {$e'$ such that $\post{e} \cap (\pre{e'} \cup \cont{e'}) \neq
\emptyset$}

\STATE $U = U \cup \peupdategenhist (e')$

\ENDFOR
\RETURN $U$

\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Procedure \peupdategenhist}
\label{alg:pe.updategenhist}

\begin{algorithmic}
\REQUIRE An event $e = \langle M_p, M_c, t \rangle$.
\ENSURE The set $A$ contains all pairs $(e, H)$ such that $H \in \hist e$ in
$\unf N$, and $H \setminus \{e\}$ is a configuration of $\enr N$, and $\langle
e, H \rangle$ is not an enriched event of $\enr N$.

\STATE Let $\{e_1, \ldots, e_n\} = \pre{M_p} \cup \pre{M_c}$

\FORALL {histories $H_1, \ldots, H_n$ such that $H_1 \in \chi (e_1)$ and \ldots
and $H_n \in \chi (e_n)$}
\STATE $f = \TRUE$
\FOR {$i = 1$ to $n$}
\STATE $f = f \land H_i \mbox{ does not consume any condition from } M_p \cup
M_c$
\FOR {$j = 1$ to $i - 1$}
\STATE $f = f \land \lnot H_j \confl H_i$
\ENDFOR
\ENDFOR

\STATE $\widehat H = \{e\} \cup H_1 \cup \ldots \cup H_n$
\IF {$f$ and not $\widehat H \in \chi (e)$}
\STATE $A = A \cup \{(e, \widehat H)\}$
\ENDIF
\ENDFOR

\RETURN $A$

\end{algorithmic}
\end{algorithm}


 % vim:syn=tex:spell:
